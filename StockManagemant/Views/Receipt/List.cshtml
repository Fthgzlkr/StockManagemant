@{
    ViewData["Title"] = "Fiş Listesi";
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/receiptlist.css" />
}



@{
    ViewData["Title"] = "Fiş Listesi";
}

<div class="receipt-page">
    <h2>@ViewData["Title"]</h2>

    <div class="date-filter">
        <span class="date-label">Fiş Tarihi Seçin: </span>
        <input type="text" name="daterange" placeholder="Tarih aralığı" value="pickedDate" />
    </div>

    <table id="receiptGrid"></table>
    <div id="receiptPager"></div>


   
</div>

<script>
    let selectedReceiptId = null;
    let startDate = null;
    let endDate = null;

    $(document).ready(function () {
             $("#receiptGrid").jqGrid({
        url: '/Receipt/GetReceipts',
        datatype: "json",
        mtype: "GET",
        colNames: ['Fiş No', 'Tarih', 'Toplam Tutar'],
        colModel: [
            { name: 'id', index: 'id', width: 80, align: "center", sortable: true, key: true,hidden:true },
            { name: 'date', index: 'date', width: 150, align: "center", sortable: true },
            { name: 'totalAmount', index: 'totalAmount', width: 100, align: "right", sortable: true },
        ],
        pager: '#receiptPager',
        rowNum: 10,
        rowList: [10, 20, 30, 50, 100],
        sortname: 'id',
        sortorder: 'asc',
        viewrecords: true,
        height: 'auto',
        loadonce: false,
        autowidth: true,
        shrinkToFit: true,
        guiStyle: "bootstrap4",
        jsonReader: {
            root: "rows",
            page: "page",
            total: "total",
            records: "records"
        },
        onSelectRow: function (id) {
            selectedReceiptId = id; // Seçili satırın ID'sini kaydet
        },
        ondblClickRow: function (rowid) {
            if (rowid) {
                selectedReceiptId = rowid; // ID'yi güncelle
                if (selectedReceiptId) {
                    const title = 'Fiş Detayları';
                    openModal(`/Receipt/Details/${selectedReceiptId}`, title, setupReceiptProductsEvents);
                } else {
                    alert('Lütfen bir satır seçin.');
                }
            }
        }
    });
       
        $("#receiptGrid").jqGrid('navGrid', '#receiptPager',
            { edit: false, add: false, del: false, search: false, refresh: true }
        );

        // Refresh butonu sıfırlama
        $(".ui-pg-button .ui-icon-refresh").parent().on("click", function () {
            startDate = null;
            endDate = null;
            $('input[name="daterange"]').val(""); // Tarih temizleme

            // Grid'i tekrar yükleme kısmı 
            $("#receiptGrid").setGridParam({
                url: `/Receipt/GetReceipts`,
                page: 1
            }).trigger("reloadGrid");
        });
    });

    // DateRangePicker aktif hale getirme
    $(function () {
        $('input[name="daterange"]').daterangepicker({
            opens: 'center',
            minDate: "2025/1/3",
            locale: {
                format: 'YYYY-MM-DD'
            }
        }, function (start, end, label) {
            startDate = start.format('YYYY-MM-DD');
            endDate = end.format('YYYY-MM-DD');

            // Seçilen tarihe göre grid'i güncelle
            $("#receiptGrid").setGridParam({
                url: `/Receipt/GetReceipts?startDate=${startDate}&endDate=${endDate}`,
                page: 1
            }).trigger("reloadGrid");
        });
    });
</script>
